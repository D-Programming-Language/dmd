#!/bin/sh

if [ $# -le 0 ]; then
    echo "Usage: $0 [filename]"
    echo ""
    echo "This tool is used to check if two generated files are the same."
    exit 2
fi

case $1 in
    *.html)
        filter_string="Generated by Ddoc from"
        ;;
    *.di)
        filter_string="D import file generated from"
        ;;
    json.out)
        filter_string="\"file\" : "
        ;;
    *)
        filter_string=
        ;;
esac

generated=${RESULTS_DIR}/compilable/$1
filtered=${RESULTS_DIR}/compilable/$1.2
expected=compilable/extra-files/$1

if [ -n "$filter_string" ]; then
    GREP_OPTIONS= grep -v "$filter_string" $generated > $filtered
else
    cp $generated $filtered
fi

diff -u --strip-trailing-cr $expected $filtered
if [ $? -ne 0 ]; then
    exit 1;
fi

rm $filtered $generated

